<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watch Movie</title>
    <style>
        :root { --bg: #141414; --primary: #e50914; --text: #fff; --sub: #a3a3a3; }
        body { background: var(--bg); color: var(--text); margin: 0; font-family: 'Segoe UI', sans-serif; }
        
        .container { max-width: 1100px; margin: 0 auto; padding: 20px; }
        .back-btn { display: inline-flex; align-items: center; color: var(--sub); text-decoration: none; font-weight: bold; margin-bottom: 20px; transition: 0.2s; }
        .back-btn:hover { color: var(--text); }

        /* Video Player */
        .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; background: #000; border-radius: 8px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; outline: none; }

        /* Details */
        .info-sec { margin-top: 30px; display: grid; grid-template-columns: 200px 1fr; gap: 30px; }
        .poster-img { width: 100%; border-radius: 4px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        
        .meta h1 { margin: 0 0 10px; font-size: 2.5rem; }
        .tags { display: flex; gap: 10px; margin-bottom: 20px; font-size: 0.9rem; color: #46d369; }
        .desc { color: var(--sub); line-height: 1.6; margin-bottom: 20px; font-size: 1.1rem; }
        
        .actions { display: flex; gap: 15px; margin-top: 20px; }
        .btn { padding: 12px 25px; border-radius: 4px; text-decoration: none; font-weight: bold; text-align: center; display: inline-block; }
        .btn-dl { background: var(--primary); color: white; }
        .btn-dl:hover { background: #b20710; }
        .btn-trailer { background: #333; color: white; }

        /* Modal for Trailer */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 100; align-items: center; justify-content: center; }
        .modal-content { width: 80%; max-width: 900px; aspect-ratio: 16/9; position: relative; }
        .close-modal { position: absolute; top: -30px; right: 0; color: white; cursor: pointer; font-size: 20px; }
        iframe { width: 100%; height: 100%; border: none; }

        @media(max-width: 768px) { .info-sec { grid-template-columns: 1fr; } .poster-img { width: 150px; display: none; } }
    </style>
</head>
<body>

    <div class="container">
        <a href="index.html" class="back-btn">‚Üê Back to Home</a>

        <div class="video-wrapper">
            <video id="player" controls playsinline controlsList="nodownload">
                <source id="video-source" src="" type="video/mp4">
                Your browser does not support video.
            </video>
        </div>

        <div class="info-sec">
            <img id="poster" class="poster-img" src="" alt="Poster">
            <div class="meta">
                <h1 id="title">Loading...</h1>
                <div class="tags">
                    <span id="year"></span> ‚Ä¢ 
                    <span id="rating"></span> ‚Ä¢ 
                    <span id="genre"></span>
                </div>
                <p id="desc" class="desc"></p>
                
                <div class="actions">
                    <a id="dl-btn" href="#" class="btn btn-dl" target="_blank">‚¨á Download</a>
                    <a id="trailer-btn" href="#" class="btn btn-trailer">üé¨ Watch Trailer</a>
                </div>
            </div>
        </div>
    </div>

    <div id="trailer-modal" class="modal">
        <div class="modal-content">
            <div class="close-modal" onclick="closeTrailer()">‚úñ Close</div>
            <iframe id="trailer-frame" src=""></iframe>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        // Enter your Worker URL here (Do not add a trailing slash)
        const WORKER_URL = "https://cloudz.flixar.workers.dev"; 

        // Load Logic
        const urlParams = new URLSearchParams(window.location.search);
        const movieId = urlParams.get('id');

        fetch('movies.json?t=' + new Date().getTime())
            .then(res => res.json())
            .then(data => {
                const movie = data.find(m => m.id === movieId);
                if(movie) {
                    // 1. Set Content
                    document.title = "Watch: " + movie.title;
                    document.getElementById('title').innerText = movie.title;
                    document.getElementById('year').innerText = movie.year;
                    document.getElementById('rating').innerText = `‚òÖ ${movie.rating}`;
                    document.getElementById('genre').innerText = movie.genre;
                    document.getElementById('desc').innerText = movie.description;
                    document.getElementById('poster').src = movie.poster;

                    // 2. Set Stream & Download
                    // We use the new /api/stream endpoint we added to the worker
                    const streamLink = `${WORKER_URL}/api/stream?id=${movie.gdrive_id}`;
                    
                    const player = document.getElementById('player');
                    document.getElementById('video-source').src = streamLink;
                    player.load();

                    document.getElementById('dl-btn').href = streamLink; // Browsers usually handle download on same link

                    // 3. Trailer Logic
                    const tBtn = document.getElementById('trailer-btn');
                    if(movie.trailer) {
                        tBtn.onclick = (e) => {
                            e.preventDefault();
                            document.getElementById('trailer-frame').src = movie.trailer;
                            document.getElementById('trailer-modal').style.display = 'flex';
                        };
                    } else {
                        tBtn.style.display = 'none';
                    }
                }
            });

        function closeTrailer() {
            document.getElementById('trailer-modal').style.display = 'none';
            document.getElementById('trailer-frame').src = '';
        }
    </script>
</body>
</html>
