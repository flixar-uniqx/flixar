<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FLIXAR</title>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #0f1014; --card: #1b1c22; --primary: #00d2ff; --text: #f5f5f5; --sub: #888; }
        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Raleway', sans-serif; background: var(--bg); color: var(--text); }
        
        /* Navbar */
        .nav { padding: 15px 4%; background: #16171b; border-bottom: 1px solid #2a2b30; position: sticky; top: 0; z-index: 100; display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between; gap: 15px; }
        .logo { display: flex; align-items: center; gap: 10px; font-weight: 700; font-size: 1.4rem; color: var(--text); text-decoration: none; }
        .logo img { height: 35px; }

        .filters { display: flex; gap: 10px; flex-wrap: wrap; }
        select, input { background: #23242a; border: 1px solid #333; color: white; padding: 8px 12px; border-radius: 4px; font-family: inherit; font-size: 0.9rem; outline: none; }
        select:focus, input:focus { border-color: var(--primary); }
        
        /* Grid */
        .container { padding: 30px 4%; min-height: 80vh; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 25px; margin-top: 20px; }
        .card { background: var(--card); border-radius: 8px; overflow: hidden; transition: 0.3s; cursor: pointer; border: 1px solid transparent; }
        .card:hover { transform: translateY(-5px); border-color: var(--primary); box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        .poster { width: 100%; aspect-ratio: 2/3; object-fit: cover; }
        .info { padding: 12px; }
        .title { font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .meta { display: flex; justify-content: space-between; margin-top: 5px; font-size: 0.8rem; color: var(--sub); }
        .badge { background: var(--primary); color: #000; padding: 2px 6px; border-radius: 3px; font-size: 0.7rem; font-weight: bold; }

        /* Footer */
        .footer { text-align: center; padding: 40px; background: #0a0a0c; border-top: 1px solid #222; margin-top: 50px; font-size: 0.9rem; color: var(--sub); }

        @media(max-width: 600px) { .nav { flex-direction: column; align-items: stretch; } .filters { justify-content: space-between; } select, input { width: 100%; } }
    </style>
</head>
<body>

    <nav class="nav">
        <a href="index.html" class="logo">
            <img src="https://cdn-icons-png.flaticon.com/512/2503/2503508.png" alt="Icon"> MOVIES HUB
        </a>
        
        <div class="filters">
            <input type="text" id="search" placeholder="Search title..." oninput="applyFilters()">
            <select id="filter-type" onchange="applyFilters()">
                <option value="All">All Types</option>
            </select>
            <select id="filter-genre" onchange="applyFilters()">
                <option value="All">All Genres</option>
            </select>
            <select id="filter-year" onchange="applyFilters()">
                <option value="All">All Years</option>
            </select>
        </div>
    </nav>

    <div class="container">
        <div id="grid" class="grid"></div>
        <div id="no-result" style="display:none; text-align:center; margin-top:50px; color:#666;">No results found.</div>
    </div>

    <div class="footer">
        &copy; 2025 Movies Hub. All Rights Reserved. <br> 
        Designed for speed and simplicity.
    </div>

    <script>
        let allMovies = [];
        
        // 1. Fetch & Initialize
        fetch('movies.json?t=' + Date.now())
            .then(res => res.json())
            .then(data => {
                allMovies = data;
                populateDropdowns(data);
                renderMovies(data);
            });

        // 2. Populate Filters Dynamically
        function populateDropdowns(data) {
            const types = new Set();
            const years = new Set();
            const genres = new Set();

            data.forEach(m => {
                if(m.type) types.add(m.type);
                if(m.year) years.add(m.year);
                if(m.genre) m.genre.split(',').forEach(g => genres.add(g.trim()));
            });

            fillSelect('filter-type', Array.from(types).sort());
            fillSelect('filter-year', Array.from(years).sort().reverse());
            fillSelect('filter-genre', Array.from(genres).sort());
        }

        function fillSelect(id, list) {
            const el = document.getElementById(id);
            list.forEach(item => {
                const opt = document.createElement('option');
                opt.value = item;
                opt.innerText = item;
                el.appendChild(opt);
            });
        }

        // 3. Render Grid
        function renderMovies(list) {
            const grid = document.getElementById('grid');
            const noRes = document.getElementById('no-result');
            grid.innerHTML = '';

            if(list.length === 0) {
                noRes.style.display = 'block';
                return;
            } else {
                noRes.style.display = 'none';
            }

            list.forEach(m => {
                const card = document.createElement('div');
                card.className = 'card';
                card.onclick = () => window.location.href = `movie.html?id=${m.id}`;
                card.innerHTML = `
                    <img src="${m.poster}" class="poster" loading="lazy">
                    <div class="info">
                        <div class="title" title="${m.title}">${m.title}</div>
                        <div class="meta">
                            <span>${m.year}</span>
                            <span class="badge">${m.type}</span>
                            <span>â˜… ${m.rating}</span>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // 4. Filtering Logic
        function applyFilters() {
            const search = document.getElementById('search').value.toLowerCase();
            const type = document.getElementById('filter-type').value;
            const genre = document.getElementById('filter-genre').value;
            const year = document.getElementById('filter-year').value;

            const filtered = allMovies.filter(m => {
                const matchSearch = m.title.toLowerCase().includes(search);
                const matchType = type === 'All' || m.type === type;
                const matchYear = year === 'All' || m.year === year;
                const matchGenre = genre === 'All' || m.genre.includes(genre);
                return matchSearch && matchType && matchYear && matchGenre;
            });

            renderMovies(filtered);
        }
    </script>
</body>
</html>
