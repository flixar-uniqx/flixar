<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamHub</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container" id="content"></div>

    <script src="config.js"></script>
    <script src="app.js"></script>
    
    <script>
        fetch('movies.json?t=' + Date.now()).then(r => r.json()).then(data => {
            const params = new URLSearchParams(window.location.search);
            const container = document.getElementById('content');
            container.innerHTML = '';

            if(params.has('search')) {
                const q = params.get('search').toLowerCase();
                renderSection(container, `Search: "${q}"`, data.filter(m => m.title.toLowerCase().includes(q)));
            } else if(params.has('genre')) {
                renderSection(container, `Genre: ${params.get('genre')}`, data.filter(m => m.genre.includes(params.get('genre'))));
            } else if(params.has('year')) {
                renderSection(container, `Year: ${params.get('year')}`, data.filter(m => m.year === params.get('year')));
            } else if(params.has('type')) {
                renderSection(container, params.get('type'), data.filter(m => m.type === params.get('type')));
            } else {
                // Default Home Layout
                renderSection(container, "Latest Uploads", data.slice(0, CONFIG.latestCount));
                renderSection(container, "Movies", data.filter(m => m.type === "Movie"));
                renderSection(container, "TV Series", data.filter(m => m.type === "TV Series"));
            }
        });

        function renderSection(container, title, list) {
            if(list.length === 0) return;
            const section = document.createElement('div');
            section.innerHTML = `<div class="section-header">${title}</div>`;
            const grid = document.createElement('div');
            grid.className = 'grid';
            
            list.forEach(m => {
                // AUTO-DETECT FOLDER NAME
                const folder = m.type === 'TV Series' ? 'series' : 'movie';
                grid.innerHTML += `
                    <div class="card" onclick="window.location.href='${folder}/index.html?id=${m.id}'">
                        <img src="${m.poster}" class="poster" loading="lazy">
                        <div class="card-info">
                            <div class="card-title">${m.title}</div>
                            <div class="card-meta"><span>${m.year}</span><span class="badge">${m.type}</span></div>
                        </div>
                    </div>`;
            });
            section.appendChild(grid);
            container.appendChild(section);
        }
    </script>
</body>
</html>
