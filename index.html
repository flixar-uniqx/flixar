<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamHub</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container" id="content"></div>

    <script src="config.js"></script>
    <script src="app.js"></script>
    <script>
        // Icons
        const ICONS = {
            fire: '<svg width="24" height="24" fill="none" stroke="#eab308" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M9.879 16.121A3 3 0 1012.015 11L11 14H9c0 .768.293 1.536.879 2.121z"></path></svg>',
            film: '<svg width="24" height="24" fill="none" stroke="#00d2ff" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"></path></svg>',
            tv: '<svg width="24" height="24" fill="none" stroke="#10b981" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>',
            search: '<svg width="24" height="24" fill="none" stroke="#fff" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>'
        };

        fetch('movies.json?t=' + Date.now())
            .then(r => r.json())
            .then(data => {
                const params = new URLSearchParams(window.location.search);
                const container = document.getElementById('content');
                container.innerHTML = '';

                if(params.has('search')) {
                    const q = params.get('search').toLowerCase();
                    renderSection(container, `${ICONS.search} Search: "${q}"`, data.filter(m => m.title.toLowerCase().includes(q)));
                } 
                else if(params.has('genre')) {
                    renderSection(container, `Genre: ${params.get('genre')}`, data.filter(m => m.genre.includes(params.get('genre'))));
                } 
                else if(params.has('year')) {
                    renderSection(container, `Year: ${params.get('year')}`, data.filter(m => m.year === params.get('year')));
                } 
                else if(params.has('type')) {
                    renderSection(container, params.get('type'), data.filter(m => m.type === params.get('type')));
                } 
                else {
                    renderSection(container, `Latest Uploads ${ICONS.fire}`, data.slice(0, CONFIG.latestCount));
                    renderSection(container, `Movies ${ICONS.film}`, data.filter(m => m.type === "Movie"));
                    renderSection(container, `TV Series ${ICONS.tv}`, data.filter(m => m.type === "TV Series"));
                }
            })
            .catch(() => document.getElementById('content').innerHTML = "<h2 style='text-align:center;margin-top:50px'>Library Loading Error.</h2>");

        function renderSection(container, titleHtml, list) {
            if(list.length === 0) return;
            const section = document.createElement('div');
            section.className = 'reveal'; // Scroll Animation
            section.innerHTML = `<div class="section-header">${titleHtml}</div>`;
            const grid = document.createElement('div');
            grid.className = 'grid';
            
            const isLocal = window.location.protocol === 'file:' || window.location.href.includes('.html');

            list.forEach(m => {
                const folder = m.type === 'TV Series' ? 'series' : 'movie';
                const link = isLocal ? `${folder}/index.html?id=${m.id}` : `${folder}/?id=${m.id}`;
                
                grid.innerHTML += `
                    <div class="card" onclick="window.location.href='${link}'">
                        <img src="${m.poster}" class="poster" loading="lazy" alt="${m.title} - ${CONFIG.siteName}">
                        <div class="card-info">
                            <div class="card-title">${m.title}</div>
                            <div class="card-meta"><span>${m.year}</span><span class="badge">${m.type}</span></div>
                        </div>
                    </div>`;
            });
            section.appendChild(grid);
            container.appendChild(section);
            
            // Trigger Animation
            if(window.IntersectionObserver) {
                const observer = new IntersectionObserver(e => e.forEach(i => { if(i.isIntersecting) i.target.classList.add('active'); }));
                observer.observe(section);
            } else section.classList.add('active');
        }
    </script>
</body>
</html>
