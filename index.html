<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamHub - Home</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container" id="content"></div>

    <script src="config.js"></script>
    <script src="app.js"></script>
    <script>
        fetch('movies.json?t=' + Date.now()).then(r => r.json()).then(data => {
            const params = new URLSearchParams(window.location.search);
            const container = document.getElementById('content');
            
            // Filtering Logic
            let list = data;
            let title = "";

            if(params.has('search')) {
                const q = params.get('search').toLowerCase();
                list = data.filter(m => m.title.toLowerCase().includes(q));
                title = `Search Results: "${q}"`;
                renderSection(container, title, list);
            } 
            else if(params.has('genre') || params.has('year') || params.has('type')) {
                if(params.has('genre')) list = list.filter(m => m.genre.includes(params.get('genre')));
                if(params.has('year')) list = list.filter(m => m.year === params.get('year'));
                if(params.has('type')) list = list.filter(m => m.type === params.get('type'));
                renderSection(container, "Filtered Results", list);
            } 
            else {
                // Default Homepage
                renderSection(container, "Latest Uploads", data.slice(0, CONFIG.latestCount));
                renderSection(container, "Movies", data.filter(m => m.type === "Movie"));
                renderSection(container, "TV Series", data.filter(m => m.type === "TV Series"));
            }
        });

        function renderSection(container, title, list) {
            if(list.length === 0) return;
            const section = document.createElement('div');
            section.innerHTML = `<div class="section-header">${title}</div>`;
            const grid = document.createElement('div');
            grid.className = 'grid';
            
            list.forEach(m => {
                // Determine folder based on type
                const folder = m.type === 'TV Series' ? 'series' : 'movie';
                grid.innerHTML += `
                    <div class="card" onclick="window.location.href='${P(folder)}?id=${m.id}'">
                        <img src="${m.poster}" class="poster" loading="lazy">
                        <div class="card-info">
                            <div class="card-title">${m.title}</div>
                            <div class="card-meta"><span>${m.year}</span><span class="badge">${m.type}</span></div>
                        </div>
                    </div>`;
            });
            section.appendChild(grid);
            container.appendChild(section);
        }
    </script>
</body>
</html>
