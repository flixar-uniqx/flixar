<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="../style.css">
    <style>
        .admin-container { max-width: 900px; margin: 50px auto; padding: 0 20px; }
        .login-box { max-width: 400px; margin: 100px auto; text-align: center; background: var(--card); padding: 40px; border-radius: 12px; }
        
        /* Form Styling */
        label { display: block; color: var(--text-dim); font-size: 0.8rem; text-transform: uppercase; margin: 15px 0 5px; font-weight: 600; letter-spacing: 1px; }
        input, select, textarea { width: 100%; padding: 12px; background: #0a0a0a; border: 1px solid var(--border); color: #fff; border-radius: 8px; font-family: inherit; }
        input:focus, textarea:focus { border-color: var(--primary); outline: none; }
        
        .row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        
        /* Dynamic Lists */
        .item-box { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 8px; margin-bottom: 10px; border: 1px solid var(--border); }
        .sub-item-box { background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin-top: 10px; border-left: 2px solid var(--primary); }
        
        .btn { background: var(--primary); color: #000; padding: 12px 25px; border-radius: 50px; font-weight: 700; border: none; cursor: pointer; width: 100%; margin-top: 20px; }
        .btn-small { background: #333; color: white; padding: 6px 12px; font-size: 0.75rem; border-radius: 4px; border: none; cursor: pointer; display: inline-block; margin-top: 5px; margin-right: 5px; }
        .btn-small:hover { background: #444; }
        
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="login" class="login-box">
        <h2 style="color:var(--primary); margin-bottom:20px;">Admin Access</h2>
        <input type="password" id="pass" placeholder="Password">
        <button class="btn" onclick="checkPass()">Login</button>
    </div>

    <div id="panel" class="admin-container hidden">
        <h1 style="border-bottom:1px solid var(--border); padding-bottom:15px; margin-bottom:30px;">Add New Entry</h1>
        
        <div class="row">
            <div><label>Type</label><select id="type" onchange="toggleType()"><option>Movie</option><option>TV Series</option></select></div>
            <div><label>ID (Unique)</label><input id="id" placeholder="man-vs-baby"></div>
        </div>

        <label>Title</label><input id="title">
        
        <div class="row">
            <div><label>Year</label><input id="year"></div>
            <div><label>Rating</label><input id="rating"></div>
        </div>

        <label>Genre</label><input id="genre" placeholder="Action, Drama">
        <label>Poster URL</label><input id="poster">
        <label>Backdrop URL</label><input id="backdrop">
        <label>Trailer (Direct URL)</label><input id="trailer">
        <label>Description</label><textarea id="desc" rows="3"></textarea>

        <div id="movie-area">
            <h3 style="color:var(--primary); margin-top:30px;">Downloads</h3>
            <div id="movie-links"></div>
            <button class="btn-small" onclick="addMovieLink()">+ Add Quality</button>
        </div>

        <div id="series-area" class="hidden">
            <h3 style="color:var(--primary); margin-top:30px;">Seasons & Episodes</h3>
            <div id="season-list"></div>
            <button class="btn-small" onclick="addSeason()">+ Add Season</button>
        </div>

        <button class="btn" onclick="generate()">Generate JSON Code</button>
        <textarea id="output" rows="10" style="margin-top:20px; font-family:monospace; color:#0f0; background:#000; width:100%; border:1px solid #333;"></textarea>
    </div>

    <script src="../config.js"></script>
    <script src="../app.js"></script>
    <script>
        const PASS = "1234"; // Change your password here

        function checkPass() {
            if(document.getElementById('pass').value === PASS) {
                document.getElementById('login').style.display = 'none';
                document.getElementById('panel').style.display = 'block';
            } else alert('Wrong Password');
        }

        function toggleType() {
            const isSeries = document.getElementById('type').value === 'TV Series';
            document.getElementById('movie-area').style.display = isSeries ? 'none' : 'block';
            document.getElementById('series-area').style.display = isSeries ? 'block' : 'none';
        }

        // --- MOVIE LOGIC ---
        function addMovieLink() {
            const div = document.createElement('div');
            div.className = 'item-box row';
            div.innerHTML = `<input placeholder="Quality (1080p)" class="q"><input placeholder="Size (2GB)" class="s"><input placeholder="Link" class="l" style="grid-column:span 2">`;
            document.getElementById('movie-links').appendChild(div);
        }

        // --- SERIES LOGIC (Nested) ---
        function addSeason() {
            const div = document.createElement('div');
            div.className = 'item-box';
            div.style.borderColor = 'var(--primary)';
            const sId = 'season-' + Date.now();
            
            div.innerHTML = `
                <input placeholder="Season Name (e.g. Season 1)" class="s-name" style="margin-bottom:10px; font-weight:bold;">
                <div id="${sId}" style="margin-left:10px; border-left:1px solid #333; padding-left:10px;"></div>
                <button class="btn-small" onclick="addEpisode('${sId}')" style="margin-top:10px;">+ Add Episode</button>
            `;
            document.getElementById('season-list').appendChild(div);
        }

        function addEpisode(seasonId) {
            const div = document.createElement('div');
            div.className = 'item-box'; 
            div.style.background = 'rgba(255,255,255,0.02)';
            const epId = 'ep-' + Math.random().toString(36).substr(2, 9);

            div.innerHTML = `
                <input placeholder="Episode Title (e.g. Episode 1)" class="e-title">
                <div id="${epId}"></div>
                <button class="btn-small" onclick="addEpLink('${epId}')">+ Add Quality Link</button>
            `;
            document.getElementById(seasonId).appendChild(div);
            
            // Add one link by default
            addEpLink(epId);
        }

        function addEpLink(epId) {
            const div = document.createElement('div');
            div.className = 'sub-item-box row';
            div.innerHTML = `<input placeholder="Quality (1080p)" class="l-label"><input placeholder="Size" class="l-size"><input placeholder="Link" class="l-url" style="grid-column:span 2">`;
            document.getElementById(epId).appendChild(div);
        }

        // --- GENERATOR ---
        function getEmbedUrl(url) {
            if (!url) return "";
            if (url.includes("/embed/")) return url;
            let videoId = "";
            if (url.includes("youtu.be/")) videoId = url.split("youtu.be/")[1].split("?")[0];
            else if (url.includes("watch?v=")) videoId = url.split("watch?v=")[1].split("&")[0];
            if (videoId) return `https://www.youtube.com/embed/${videoId}`;
            return url;
        }

        function generate() {
            let obj = {
                id: document.getElementById('id').value,
                type: document.getElementById('type').value,
                title: document.getElementById('title').value,
                year: document.getElementById('year').value,
                genre: document.getElementById('genre').value,
                rating: document.getElementById('rating').value,
                poster: document.getElementById('poster').value,
                backdrop: document.getElementById('backdrop').value,
                description: document.getElementById('desc').value,
                trailer_embed: getEmbedUrl(document.getElementById('trailer').value)
            };

            if (obj.type === 'Movie') {
                obj.downloads = [];
                document.querySelectorAll('#movie-links .item-box').forEach(row => {
                    if(row.querySelector('.q').value) {
                        obj.downloads.push({
                            quality: row.querySelector('.q').value,
                            size: row.querySelector('.s').value,
                            link: row.querySelector('.l').value
                        });
                    }
                });
            } else {
                obj.seasons = [];
                document.querySelectorAll('#season-list > .item-box').forEach(sDiv => {
                    let season = { name: sDiv.querySelector('.s-name').value, episodes: [] };
                    
                    // Loop Episodes
                    sDiv.querySelectorAll('div[id^="season-"] > .item-box').forEach(epDiv => {
                        let ep = { 
                            title: epDiv.querySelector('.e-title').value,
                            links: [] 
                        };

                        // Loop Links inside Episode
                        epDiv.querySelectorAll('.sub-item-box').forEach(lDiv => {
                            if(lDiv.querySelector('.l-label').value) {
                                ep.links.push({
                                    label: lDiv.querySelector('.l-label').value,
                                    size: lDiv.querySelector('.l-size').value,
                                    link: lDiv.querySelector('.l-url').value
                                });
                            }
                        });
                        season.episodes.push(ep);
                    });
                    obj.seasons.push(season);
                });
            }

            document.getElementById('output').value = ",\n" + JSON.stringify(obj, null, 2);
        }
    </script>
</body>
</html>
