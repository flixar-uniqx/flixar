<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FLIX·êÉR | Bring the Theatre to Your Home</title>
    <link rel="stylesheet" href="../style.css">
    <style>
        /* --- ADMIN SPECIFIC STYLES --- */
        body { 
            background-color: var(--bg); 
            background-image: radial-gradient(circle at top right, rgba(0, 210, 255, 0.1), transparent 40%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Centered Login Screen */
        #login-container {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-box {
            background: rgba(25, 25, 25, 0.8);
            backdrop-filter: blur(20px);
            padding: 40px;
            border-radius: 24px;
            border: 1px solid var(--border);
            width: 100%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        /* Dashboard Layout */
        #panel {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            width: 100%;
            display: none; /* Hidden by default */
            padding-bottom: 100px;
        }

        /* Inputs & Forms */
        .form-group { margin-bottom: 15px; text-align: left; }
        label { display: block; color: var(--text-dim); font-size: 0.85rem; margin-bottom: 5px; font-weight: 600; }
        
        input, textarea, select { 
            width: 100%; 
            background: rgba(255,255,255,0.05); 
            border: 1px solid var(--border); 
            color: #fff; 
            padding: 12px 15px; 
            border-radius: 12px; 
            font-family: 'Inter', sans-serif;
            transition: 0.2s;
            outline: none;
        }
        input:focus, textarea:focus, select:focus {
            border-color: var(--primary);
            background: rgba(0,0,0,0.5);
            box-shadow: 0 0 15px rgba(0, 210, 255, 0.1);
        }

        /* Buttons */
        .btn {
            background: var(--primary); color: #000; border: none; 
            padding: 12px 24px; border-radius: 99px; font-weight: 700; 
            cursor: pointer; transition: 0.2s; display: inline-flex; 
            align-items: center; justify-content: center; gap: 8px;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(0, 210, 255, 0.3); }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: #fff; }
        .btn-outline:hover { border-color: #fff; background: rgba(255,255,255,0.05); }
        .btn-danger { background: #ef4444; color: white; }
        .btn-danger:hover { background: #dc2626; box-shadow: 0 5px 20px rgba(220, 38, 38, 0.3); }

        /* Password Toggle */
        .pass-wrapper { position: relative; }
        .pass-toggle {
            position: absolute; right: 15px; top: 50%; transform: translateY(-50%);
            cursor: pointer; color: var(--text-dim);
        }

        /* Grid Layouts */
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }
        .item-box { background: var(--surface); padding: 20px; border-radius: 16px; margin-bottom: 20px; border: 1px solid var(--border); }
        
        /* TMDB Results */
        .res-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; margin-top: 15px; }
        .res-card { background: #000; border-radius: 8px; overflow: hidden; cursor: pointer; border: 1px solid transparent; transition: 0.2s; }
        .res-card:hover { border-color: var(--primary); transform: scale(1.05); }
        .res-img { width: 100%; aspect-ratio: 2/3; object-fit: cover; }
        .res-txt { padding: 5px; font-size: 0.7rem; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* Toolbar */
        .toolbar { 
            display: flex; justify-content: space-between; align-items: center; 
            background: rgba(20,20,20,0.8); backdrop-filter: blur(10px); 
            padding: 15px; border-radius: 16px; border: 1px solid var(--border); 
            margin-bottom: 20px; position: sticky; top: 10px; z-index: 100;
        }

        @media(max-width: 600px) {
            .grid-3 { grid-template-columns: 1fr; }
            .toolbar { flex-direction: column; gap: 10px; }
            .toolbar h2 { margin-bottom: 5px; }
            .toolbar div { display: flex; gap: 10px; width: 100%; }
            .toolbar button { flex: 1; }
        }
    </style>
</head>
<body>

    <div id="login-container">
        <div class="login-box">
            <h2 style="margin-top:0; color:#fff;">Admin Access</h2>
            <p style="color:var(--text-dim); font-size:0.9rem; margin-bottom:30px;">Enter your secure credentials</p>
            
            <div class="form-group pass-wrapper">
                <input type="password" id="pass" placeholder="Password" onkeypress="if(event.key==='Enter') login()">
                <div class="pass-toggle" onclick="togglePass()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                </div>
            </div>
            
            <button class="btn" onclick="login()" style="width:100%;">Unlock Panel</button>
            <div id="login-error" style="color:#ef4444; margin-top:15px; font-size:0.9rem; display:none;">Incorrect Password</div>
        </div>
    </div>

    <div id="panel">
        
        <div class="toolbar">
            <h2 style="margin:0; font-size:1.2rem;">Content Manager</h2>
            <div>
                <button onclick="createNew()" class="btn btn-outline">Clear Form</button>
                <button onclick="logout()" class="btn btn-danger">Log Off</button>
                <button onclick="saveAll()" class="btn">GENERATE JSON</button>
            </div>
        </div>

        <div class="item-box" style="border-color: var(--primary);">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h3 style="margin:0;">Import from TMDB</h3>
                <span style="font-size:0.8rem; color:var(--primary);">Auto-Fill Enabled</span>
            </div>
            <div style="display: flex; gap: 10px;">
                <input id="tmdb-search" placeholder="Enter Movie or Series name..." onkeypress="if(event.key==='Enter') searchTMDB()">
                <button onclick="searchTMDB()" class="btn">Search</button>
            </div>
            <div id="tmdb-results" class="res-grid"></div>
        </div>

        <div class="item-box">
            <h3>Edit Existing Content</h3>
            <select id="db-list" onchange="loadFromDB(this.value)">
                <option value="">Loading database...</option>
            </select>
        </div>

        <div class="item-box">
            <h3 style="color:var(--primary); margin-top:0;">Metadata Editor</h3>
            
            <div class="grid-3">
                <div class="form-group">
                    <label>Unique ID</label>
                    <input id="id" placeholder="tt1234567">
                </div>
                <div class="form-group">
                    <label>Type</label>
                    <select id="type" onchange="toggleType()">
                        <option value="Movie">Movie</option>
                        <option value="TV Series">TV Series</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Year</label>
                    <input id="year" placeholder="2025">
                </div>
            </div>

            <div class="form-group">
                <label>Title</label>
                <input id="title" style="font-size:1.1rem; font-weight:bold;">
            </div>

            <div class="grid-3">
                <div class="form-group">
                    <label>Rating (IMDb)</label>
                    <input id="rating" placeholder="8.5">
                </div>
                <div class="form-group" style="grid-column: span 2;">
                    <label>Genres</label>
                    <input id="genre" placeholder="Action, Sci-Fi, Drama">
                </div>
            </div>

            <div class="grid-3">
                <div class="form-group">
                    <label>Poster URL</label>
                    <input id="poster" onchange="updatePreview()">
                    <img id="preview-poster" style="width:100%; border-radius:8px; margin-top:10px; display:none;">
                </div>
                <div class="form-group" style="grid-column: span 2;">
                    <div class="form-group">
                        <label>Backdrop URL</label>
                        <input id="backdrop">
                    </div>
                    <div class="form-group">
                        <label>Trailer (YouTube Link)</label>
                        <input id="trailer">
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="desc" rows="5"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <div class="item-box">
            <h3 style="color:var(--primary); margin-top:0;">File Links</h3>
            
            <div id="movie-area">
                <div id="movie-links"></div>
                <button class="btn btn-outline" onclick="addMovieLink()" style="width:100%; margin-top:10px;">+ Add Quality Option</button>
            </div>

            <div id="series-area" style="display:none;">
                <div id="season-list"></div>
                <button class="btn btn-outline" onclick="addSeason()" style="width:100%; margin-top:15px;">+ Manually Add Season</button>
            </div>
        </div>

    </div>

    <div id="output-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:2000; align-items:center; justify-content:center; padding:20px;">
        <div class="login-box" style="max-width:800px; text-align:left;">
            <h2 style="margin-top:0;">Generated JSON</h2>
            <p style="color:#aaa; font-size:0.9rem;">Copy this code and replace the content of <code>movies.json</code></p>
            <textarea id="final-output" style="width:100%; height:400px; font-family:monospace; font-size:0.8rem;"></textarea>
            <div style="display:flex; gap:10px; margin-top:20px;">
                <button class="btn" onclick="navigator.clipboard.writeText(document.getElementById('final-output').value); alert('Copied!')">Copy to Clipboard</button>
                <button class="btn btn-outline" onclick="document.getElementById('output-modal').style.display='none'">Close</button>
            </div>
        </div>
    </div>

    <script src="../config.js"></script>
    <script src="../app.js"></script>
    
    <script>
        // --- 1. SECURITY CONFIG ---
        // SHA-256 Hash for "admin123"
        // To change password, generate new SHA256 hash online and paste here
        const SECURE_HASH = "240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9"; 
        
        // TMDB API Key (Free Demo Key)
        const API_KEY = "eb85612251f740af4fe90af669148679"; 
        
        let currentDB = [];

        // --- 2. AUTHENTICATION LOGIC ---
        
        async function login() {
            const input = document.getElementById('pass').value;
            const buffer = new TextEncoder().encode(input);
            const hashBuffer = await crypto.subtle.digest('SHA-256', buffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');

            if(hashHex === SECURE_HASH) {
                document.getElementById('login-container').style.display = 'none';
                document.getElementById('panel').style.display = 'block';
                loadCurrentDB();
            } else {
                const err = document.getElementById('login-error');
                err.style.display = 'block';
                err.innerText = "Access Denied";
            }
        }

        function logout() {
            location.reload();
        }

        function togglePass() {
            const el = document.getElementById('pass');
            el.type = el.type === 'password' ? 'text' : 'password';
        }

        // --- 3. DATABASE LOGIC ---
        function loadCurrentDB() {
            fetch('../movies.json?t=' + Date.now())
                .then(r => r.json())
                .then(data => {
                    currentDB = data;
                    const sel = document.getElementById('db-list');
                    sel.innerHTML = '<option value="">Select a movie to edit...</option>';
                    data.slice().reverse().forEach((m, idx) => {
                        // idx in reversed array needs mapping back to original
                        const originalIdx = data.length - 1 - idx;
                        sel.innerHTML += `<option value="${originalIdx}">${m.title} (${m.year})</option>`;
                    });
                });
        }

        function loadFromDB(index) {
            if(index === "") return;
            const data = currentDB[index];
            
            // Populate Fields
            document.getElementById('id').value = data.id;
            document.getElementById('type').value = data.type;
            toggleType();
            document.getElementById('title').value = data.title;
            document.getElementById('year').value = data.year;
            document.getElementById('rating').value = data.rating;
            document.getElementById('genre').value = data.genre;
            document.getElementById('poster').value = data.poster;
            document.getElementById('backdrop').value = data.backdrop;
            document.getElementById('desc').value = data.description;
            document.getElementById('trailer').value = data.trailer_embed;
            updatePreview();

            // Populate Links
            if(data.type === 'Movie') {
                document.getElementById('movie-links').innerHTML = '';
                if(data.downloads) data.downloads.forEach(d => addMovieLink(d));
                else addMovieLink();
            } else {
                document.getElementById('season-list').innerHTML = '';
                if(data.seasons) {
                    data.seasons.forEach((s) => {
                        createSeasonUI(s.name, s.episodes);
                    });
                }
            }
        }

        // --- 4. TMDB INTEGRATION ---
        async function searchTMDB() {
            const query = document.getElementById('tmdb-search').value;
            if(!query) return;
            
            const res = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${API_KEY}&query=${encodeURIComponent(query)}`);
            const data = await res.json();
            
            const container = document.getElementById('tmdb-results');
            container.innerHTML = '';
            
            data.results.forEach(item => {
                if(item.media_type !== 'movie' && item.media_type !== 'tv') return;
                const title = item.title || item.name;
                const year = (item.release_date || item.first_air_date || '').split('-')[0];
                const poster = item.poster_path ? `https://image.tmdb.org/t/p/w200${item.poster_path}` : 'https://via.placeholder.com/200';
                
                // Highlight if in DB
                const exists = currentDB.find(x => x.title === title && x.year == year);
                const border = exists ? 'border: 2px solid var(--primary);' : '';

                container.innerHTML += `
                    <div class="res-card" style="${border}" onclick="fetchTMDBDetails('${item.id}', '${item.media_type}')">
                        <img src="${poster}" class="res-img">
                        <div class="res-txt">${title}<br>(${year})</div>
                    </div>`;
            });
        }

        async function fetchTMDBDetails(id, type) {
            const res = await fetch(`https://api.themoviedb.org/3/${type}/${id}?api_key=${API_KEY}&append_to_response=videos,external_ids`);
            const data = await res.json();
            let imdbId = data.external_ids ? data.external_ids.imdb_id : (type + '-' + id);

            // Check overwrite
            const existingIndex = currentDB.findIndex(x => x.id === imdbId || x.title === (data.title || data.name));
            let existingData = null;

            if(existingIndex > -1) {
                if(!confirm("Overwrite existing Metadata? Links will be preserved.")) return;
                existingData = currentDB[existingIndex];
            }

            // Fill Form
            document.getElementById('id').value = imdbId || existingData?.id;
            document.getElementById('type').value = type === 'movie' ? 'Movie' : 'TV Series';
            toggleType();
            
            document.getElementById('title').value = data.title || data.name;
            document.getElementById('year').value = (data.release_date || data.first_air_date || '').split('-')[0];
            document.getElementById('rating').value = data.vote_average.toFixed(1);
            document.getElementById('genre').value = data.genres.map(g => g.name).join(', ');
            
            const poster = data.poster_path ? `https://image.tmdb.org/t/p/w500${data.poster_path}` : '';
            const backdrop = data.backdrop_path ? `https://image.tmdb.org/t/p/original${data.backdrop_path}` : '';
            
            document.getElementById('poster').value = poster;
            document.getElementById('backdrop').value = backdrop;
            document.getElementById('desc').value = data.overview;
            updatePreview();

            const vid = data.videos.results.find(v => v.type === "Trailer" && v.site === "YouTube");
            document.getElementById('trailer').value = vid ? `https://www.youtube.com/watch?v=${vid.key}` : '';

            // Handle Episodes
            if(type === 'tv') {
                document.getElementById('season-list').innerHTML = '';
                const seasonCount = data.number_of_seasons;
                
                // Limit auto-fetch to 10 seasons for performance
                for(let s = 1; s <= Math.min(seasonCount, 10); s++) {
                    const sRes = await fetch(`https://api.themoviedb.org/3/tv/${data.id}/season/${s}?api_key=${API_KEY}`);
                    const sData = await sRes.json();
                    
                    // Match with existing links if any
                    let oldSeason = existingData?.seasons?.find(os => os.name.includes(`Season ${s}`));
                    
                    let episodes = [];
                    if(sData.episodes) {
                        sData.episodes.forEach(ep => {
                            let oldEp = oldSeason?.episodes.find(oe => oe.title.includes(ep.name) || oe.title.startsWith(`${ep.episode_number}.`));
                            episodes.push({
                                title: `${ep.episode_number}. ${ep.name}`,
                                links: oldEp ? oldEp.links : []
                            });
                        });
                    }
                    createSeasonUI(sData.name || `Season ${s}`, episodes);
                }
            } else {
                // Movie
                 document.getElementById('movie-links').innerHTML = '';
                if(existingData && existingData.downloads) {
                    existingData.downloads.forEach(d => addMovieLink(d));
                } else {
                    addMovieLink();
                }
            }
        }

        // --- 5. UI HELPERS ---

        function updatePreview() {
            const url = document.getElementById('poster').value;
            const img = document.getElementById('preview-poster');
            if(url) { img.src = url; img.style.display = 'block'; } 
            else { img.style.display = 'none'; }
        }

        function createNew() {
            document.querySelectorAll('input, textarea').forEach(i => i.value = '');
            document.getElementById('movie-links').innerHTML = '';
            document.getElementById('season-list').innerHTML = '';
            updatePreview();
            addMovieLink();
        }

        function toggleType() {
            const isSeries = document.getElementById('type').value === 'TV Series';
            document.getElementById('movie-area').style.display = isSeries ? 'none' : 'block';
            document.getElementById('series-area').style.display = isSeries ? 'block' : 'none';
        }

        function addMovieLink(data = null) {
            const div = document.createElement('div');
            div.className = 'grid-3';
            div.style.background = 'rgba(0,0,0,0.3)';
            div.style.padding = '10px';
            div.style.borderRadius = '8px';
            div.style.marginBottom = '10px';
            div.innerHTML = `
                <input placeholder="Quality (e.g. 1080p)" class="q" value="${data ? data.quality : ''}">
                <input placeholder="Size (e.g. 2GB)" class="s" value="${data ? data.size : ''}">
                <div style="display:flex; gap:5px;">
                    <input placeholder="Download Link" class="l" value="${data ? (CONFIG.fileBaseUrl + data.link) : ''}">
                    <button class="btn-danger" style="padding:0 10px;" onclick="this.parentElement.parentElement.remove()">X</button>
                </div>
            `;
            document.getElementById('movie-links').appendChild(div);
        }

        function createSeasonUI(name, episodes = []) {
            const sId = 's-' + Math.random().toString(36).substr(2, 5);
            const div = document.createElement('div');
            div.className = 'item-box';
            div.style.borderColor = 'var(--primary)';
            
            let epHTML = '';
            episodes.forEach(ep => {
                const epId = 'ep-' + Math.random().toString(36).substr(2, 5);
                let linkHTML = '';
                if(ep.links && ep.links.length > 0) {
                     ep.links.forEach(l => {
                         linkHTML += createLinkRowHTML(l.label, l.size, l.link);
                     });
                }

                epHTML += `
                    <div class="item-box" id="${epId}" style="background:rgba(255,255,255,0.03);">
                        <div style="display:flex; gap:10px; margin-bottom:10px;">
                            <input class="e-title" value="${ep.title}" style="font-weight:bold;">
                            <button class="btn-danger" style="width:auto;" onclick="this.parentElement.parentElement.remove()">X</button>
                        </div>
                        <div class="ep-links">${linkHTML}</div>
                        <button class="btn-small btn-outline" onclick="addLinkToEp('${epId}')">+ Add Link</button>
                    </div>
                `;
            });

            div.innerHTML = `
                <div style="display:flex; gap:10px; margin-bottom:10px;">
                    <input class="s-name" value="${name}" style="font-size:1.1rem; font-weight:bold; color:var(--primary);">
                    <button class="btn-danger" style="width:auto;" onclick="this.parentElement.parentElement.remove()">Remove Season</button>
                </div>
                <div class="season-eps">${epHTML}</div>
                <button class="btn-small" onclick="addEmptyEpToSeason(this.parentElement.querySelector('.season-eps'))">+ Add Episode</button>
            `;
            document.getElementById('season-list').appendChild(div);
        }

        function addSeason() {
            createSeasonUI("Season 1", [{title: "Episode 1", links: []}]);
        }

        function addEmptyEpToSeason(container) {
            const epId = 'ep-' + Math.random().toString(36).substr(2, 5);
            const div = document.createElement('div');
            div.className = 'item-box';
            div.id = epId;
            div.style.background = 'rgba(255,255,255,0.03)';
            div.innerHTML = `
                <div style="display:flex; gap:10px; margin-bottom:10px;">
                    <input class="e-title" placeholder="Episode Title" style="font-weight:bold;">
                    <button class="btn-danger" style="width:auto;" onclick="this.parentElement.parentElement.remove()">X</button>
                </div>
                <div class="ep-links"></div>
                <button class="btn-small btn-outline" onclick="addLinkToEp('${epId}')">+ Add Link</button>
            `;
            container.appendChild(div);
            addLinkToEp(epId);
        }

        function addLinkToEp(epId) {
            const container = document.querySelector(`#${epId} .ep-links`);
            const div = document.createElement('div');
            div.className = 'grid-3';
            div.style.marginBottom = '5px';
            div.innerHTML = createLinkRowHTML('', '', '');
            container.appendChild(div);
        }

        function createLinkRowHTML(q, s, l) {
            return `
                <input placeholder="Quality" class="l-label" value="${q || ''}">
                <input placeholder="Size" class="l-size" value="${s || ''}">
                <div style="display:flex; gap:5px;">
                    <input placeholder="Link" class="l-url" value="${l ? (CONFIG.fileBaseUrl + l) : ''}">
                    <button class="btn-danger" style="padding:0 10px;" onclick="this.parentElement.parentElement.remove()">X</button>
                </div>`;
        }

        // --- 6. GENERATE & SAVE ---
        
        function getEmbedUrl(url) {
            if (!url) return "";
            if (url.includes("/embed/")) return url;
            let videoId = "";
            if (url.includes("youtu.be/")) videoId = url.split("youtu.be/")[1].split("?")[0];
            else if (url.includes("watch?v=")) videoId = url.split("watch?v=")[1].split("&")[0];
            return videoId ? `https://www.youtube.com/embed/${videoId}` : url;
        }

        function cleanDownLink(url) {
            if(!url) return "";
            const base = CONFIG.fileBaseUrl;
            if(base && url.startsWith(base)) return url.replace(base, "");
            return url;
        }

        function saveAll() {
            // Construct Object
            let obj = {
                id: document.getElementById('id').value,
                type: document.getElementById('type').value,
                title: document.getElementById('title').value,
                year: document.getElementById('year').value,
                genre: document.getElementById('genre').value,
                rating: document.getElementById('rating').value,
                poster: document.getElementById('poster').value,
                backdrop: document.getElementById('backdrop').value,
                description: document.getElementById('desc').value,
                trailer_embed: getEmbedUrl(document.getElementById('trailer').value),
                date_added: new Date().toISOString()
            };

            if (obj.type === 'Movie') {
                obj.downloads = [];
                document.querySelectorAll('#movie-links .grid-3').forEach(row => {
                    const l = row.querySelector('.l').value;
                    const q = row.querySelector('.q').value;
                    const s = row.querySelector('.s').value;
                    if(q && l) obj.downloads.push({ quality: q, size: s, link: cleanDownLink(l) });
                });
            } else {
                obj.seasons = [];
                // Iterate Seasons
                const seasonCards = document.querySelectorAll('#season-list > .item-box');
                seasonCards.forEach(sCard => {
                    let season = {
                        name: sCard.querySelector('.s-name').value,
                        episodes: []
                    };
                    // Iterate Episodes
                    sCard.querySelectorAll('.season-eps > .item-box').forEach(epCard => {
                        let ep = {
                            title: epCard.querySelector('.e-title').value,
                            links: []
                        };
                        // Iterate Links
                        epCard.querySelectorAll('.ep-links > .grid-3').forEach(lRow => {
                            const l = lRow.querySelector('.l-url').value;
                            const q = lRow.querySelector('.l-label').value;
                            const s = lRow.querySelector('.l-size').value;
                            if(q && l) ep.links.push({ label: q, size: s, link: cleanDownLink(l) });
                        });
                        season.episodes.push(ep);
                    });
                    obj.seasons.push(season);
                });
            }

            // Upsert into DB
            const idx = currentDB.findIndex(x => x.id === obj.id);
            if(idx > -1) currentDB[idx] = obj;
            else currentDB.push(obj);

            // Show Output
            document.getElementById('final-output').value = JSON.stringify(currentDB, null, 2);
            document.getElementById('output-modal').style.display = 'flex';
        }
    </script>
</body>
</html>
