<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watching...</title>
    <style>
        :root { --bg: #141414; --primary: #e50914; --text: #fff; }
        body { background: var(--bg); color: var(--text); margin: 0; font-family: sans-serif; display: flex; flex-direction: column; min-height: 100vh; }
        
        .navbar { padding: 15px 20px; background: rgba(0,0,0,0.8); }
        .back-btn { text-decoration: none; color: #ddd; font-weight: bold; font-size: 1.1rem; display: flex; align-items: center; gap: 5px; }
        .back-btn:hover { color: var(--primary); }

        .player-wrapper { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .video-container { width: 100%; max-width: 1000px; aspect-ratio: 16/9; background: #000; box-shadow: 0 0 50px rgba(229, 9, 20, 0.2); border-radius: 8px; overflow: hidden; }
        video { width: 100%; height: 100%; outline: none; }

        .controls { max-width: 1000px; width: 100%; margin-top: 20px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        .meta h1 { margin: 0 0 5px 0; font-size: 1.8rem; }
        .meta p { color: #aaa; margin: 0; max-width: 600px; line-height: 1.5; }

        .actions .btn { padding: 12px 25px; border-radius: 4px; text-decoration: none; font-weight: bold; display: inline-block; background: #333; color: white; transition: 0.2s; }
        .actions .btn-dl { background: var(--primary); }
        .actions .btn:hover { opacity: 0.8; }
    </style>
</head>
<body>

    <nav class="navbar">
        <a href="index.html" class="back-btn">← Back to Home</a>
    </nav>

    <div class="player-wrapper">
        <div class="video-container">
            <video id="player" controls playsinline poster="">
                <source id="video-source" src="" type="video/mp4">
                Your browser does not support HTML5 video.
            </video>
        </div>

        <div class="controls">
            <div class="meta">
                <h1 id="title">Loading Title...</h1>
                <p id="desc">Loading description...</p>
            </div>
            <div class="actions">
                <a id="download-btn" href="#" class="btn btn-dl" target="_blank">⬇ Download</a>
            </div>
        </div>
    </div>

    <script>
        // --- YOUR CLOUDFLARE WORKER CONFIGURATION ---
        // Enter the full URL of your worker (without the trailing slash)
        const WORKER_BASE_URL = "https://your-worker-name.your-subdomain.workers.dev"; 
        
        // Load Data
        const urlParams = new URLSearchParams(window.location.search);
        const movieId = urlParams.get('id');

        fetch('movies.json?v=' + new Date().getTime())
            .then(res => res.json())
            .then(movies => {
                const movie = movies.find(m => m.id === movieId);
                
                if (movie) {
                    // 1. Construct the stream URL using your Worker + GDrive ID
                    // Assuming your worker accepts: https://worker.dev/GDRIVE_ID
                    const streamUrl = `${WORKER_BASE_URL}/${movie.gdrive_id}`;
                    
                    // 2. Update UI
                    document.title = "Watching: " + movie.title;
                    document.getElementById('title').innerText = movie.title;
                    document.getElementById('desc').innerText = movie.description;
                    
                    // 3. Setup Player
                    const player = document.getElementById('player');
                    document.getElementById('video-source').src = streamUrl;
                    player.poster = movie.backdrop || movie.poster;
                    player.load(); // Important to refresh source

                    // 4. Setup Download Button
                    // Most workers trigger download if you add ?alt=media or similar, or just open in new tab
                    document.getElementById('download-btn').href = streamUrl + "?download=true"; 
                } else {
                    document.body.innerHTML = "<h1 style='text-align:center; margin-top:50px'>Movie Not Found</h1>";
                }
            });
    </script>
</body>
</html>
